{% extends "base.html" %}
{% block title %}Admin - Baixar Fotos{% endblock %}
{% block content %}
<h1>Baixar Fotos por Dispositivo</h1>

<form method="get" action="{{ url_for('admin_photos') }}">
  <div style="display:grid; grid-template-columns: repeat(4, minmax(140px,1fr)); gap:12px; max-width:900px;">
    <div>
      <label>Início</label>
      <input type="date" name="start" value="{{ start }}">
    </div>
    <div>
      <label>Fim</label>
      <input type="date" name="end" value="{{ end }}">
    </div>
    <div>
      <label>Usuário</label>
      <select name="user_id">
        <option value="">-- Todos --</option>
        {% for u in users %}
          <option value="{{ u.id }}" {% if selected_user_id == u.id %}selected{% endif %}>{{ u.username }}</option>
        {% endfor %}
      </select>
    </div>
    <div style="align-self:end;">
      <button class="btn" type="submit">Aplicar Filtros</button>
    </div>
  </div>
</form>

<form method="post" action="{{ url_for('admin_photos_zip') }}">
  <input type="hidden" name="start" value="{{ start }}">
  <input type="hidden" name="end" value="{{ end }}">
  <input type="hidden" name="user_id" value="{{ selected_user_id or '' }}">

  <h2>Dispositivos</h2>
  {% if devices %}
    <div style="display:grid; grid-template-columns: repeat(2, 1fr); gap:6px; max-width:700px;">
      {% for d in devices %}
        <label style="border:1px solid #e5e7eb; border-radius:8px; padding:8px; background:#fafafa;">
          <input type="checkbox" name="devices" value="{{ d.device_name }}">
          <strong>{{ d.device_name }}</strong>
          <small style="color:#555;"> — registros: {{ d.registros }} | fotos: {{ d.fotos }}</small>
        </label>
      {% endfor %}
    </div>
    <div style="margin-top:12px;">
      <button class="btn" type="submit">Baixar ZIP com fotos selecionadas</button>
    </div>
  {% else %}
    <p>Nenhum dispositivo encontrado para os filtros.</p>
  {% endif %}
</form>

<p style="margin-top:16px;"><a class="btn secondary" href="{{ url_for('admin_home') }}">Voltar</a></p>
{% endblock %}
