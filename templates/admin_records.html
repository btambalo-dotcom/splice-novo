{% extends "base.html" %}
{% block title %}Admin - Registros{% endblock %}
{% block content %}
<h1>Registros</h1>
<form method="get" action="{{ url_for('admin_records') }}">
  <label>Filtrar por usuário:</label>
  <select name="user_id" onchange="this.form.submit()">
    <option value="">-- Todos --</option>
    {% for u in users %}
      <option value="{{ u.id }}" {% if selected_user_id == u.id %}selected{% endif %}>{{ u.username }}</option>
    {% endfor %}
  </select>
  <noscript><button class="btn" type="submit">Filtrar</button></noscript>
</form>

<p style="margin-top:10px;">
  <a class="btn secondary" href="{{ url_for('admin_export_csv') }}{% if selected_user_id %}?user_id={{ selected_user_id }}{% endif %}">Exportar CSV</a>
</p>

<table class="table">
  <tr><th>ID</th><th>Usuário</th><th>Dispositivo</th><th>Fusões</th><th>Criado em</th><th>Fotos</th><th>Detalhes</th></tr>
  {% for r in records %}
  <tr>
    <td>{{ r.id }}</td>
    <td>{{ r.username }}</td>
    <td>{{ r.device_name }}</td>
    <td>{{ r.fusion_count }}</td>
    <td>{{ r.created_at }}</td>
    <td><a class="btn" href="{{ url_for('view_record', record_id=r.id) }}" target="_blank">ver</a></td>
    <td><a class="btn secondary" href='{{ url_for("view_record", record_id=r.id) }}'>Abrir</a></td>
  </tr>
  {% endfor %}
</table>

<p><a class="btn secondary" href="{{ url_for('admin_home') }}">Voltar</a></p>
{% endblock %}
